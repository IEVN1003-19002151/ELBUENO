import{c as m,g as s,s as l}from"./chunk-UEFORAMN.js";import{a as o,b as n}from"./chunk-TRNF7YA4.js";var p=class a{items=new m([]);constructor(){let t=localStorage.getItem("carrito");if(t)try{let e=JSON.parse(t).filter(i=>i.imagenUrl);this.items.next(e)}catch(r){console.error("Error al cargar el carrito:",r),this.items.next([])}}agregarItem(t){if(!t.imagenUrl){console.error("Intentando agregar item sin imagen:",t);return}if(typeof t.precio!="number"||typeof t.cantidad!="number"){console.error("Precio o cantidad no v\xE1lidos:",t);return}let r=this.items.getValue(),e=r.find(i=>i.id===t.id&&i.tipo===t.tipo);e?(e.cantidad+=t.cantidad,this.items.next([...r])):this.items.next([...r,n(o({},t),{cantidad:t.cantidad})]),this.guardarEnLocalStorage()}getItems(){return this.items.asObservable()}getCantidadItems(){return this.items.pipe(s(t=>t.reduce((r,e)=>r+e.cantidad,0)))}getTotal(){return this.items.pipe(s(t=>t.reduce((r,e)=>typeof e.precio=="number"&&typeof e.cantidad=="number"?r+e.precio*e.cantidad:r,0)))}actualizarCantidad(t,r,e){let i=this.items.getValue(),c=i.findIndex(d=>d.id===t&&d.tipo===r);c!==-1&&(i[c].cantidad=e,this.items.next([...i]),this.guardarEnLocalStorage())}eliminarItem(t,r){let e=this.items.getValue().filter(i=>!(i.id===t&&i.tipo===r));this.items.next(e),this.guardarEnLocalStorage()}limpiarCarrito(){this.items.next([]),localStorage.removeItem("carrito")}guardarEnLocalStorage(){let t=this.items.getValue().map(r=>n(o({},r),{imagenUrl:r.imagenUrl||""}));localStorage.setItem("carrito",JSON.stringify(t))}static \u0275fac=function(r){return new(r||a)};static \u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"})};export{p as a};
